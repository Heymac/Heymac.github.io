<!DOCTYPE html>
<html>
<head>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap');
	</style>
	<style>
		:root {
		  --grey: #5959597a;
		  --white: #ffffff;
		  --gold: #F9BB36;
		  --green: #207350;
		  --purple: #C359D3;
		  --blue: #3D84E2;
		  --lightgreen: #38B287;
		}
	body {
		background-color: #222222;
		margin: 2.5vw;
		row-gap: 2vw;
		display: flex;
		flex-direction: column;
	}
	div{
		display: flex;
	}

	::-webkit-scrollbar {
	  width: 1vw;
	}
	::-webkit-scrollbar-track {
	  background: none; 
	}
	::-webkit-scrollbar-thumb {
	  background: var(--grey); 
	  border-radius: 1vw;
	}
	::-webkit-scrollbar-thumb:hover {
	  background: #555; 
	}

	.column{
		display: flex;
  		flex-direction: column;
	}
	#day1{
		display: flex;
		flex-direction: row;
		justify-content: center;
	}
	.button{
		display: flex;
	}
	.hour{
		font-family: roboto;
    	color: white;
    	font-size: 1.5vw;
    	align-self: center;
	}
	.text{
		font-family: roboto;
    	color: white;
    	font-size: 1.5vw;
	}
	.workcolumn{
		/*background-color: #ffffff17;*/
	}
	#income{

	}
	#income div{
		display: initial;
		flex: 1 1 0px;
	}
	#paycheck, #dailyincome{
		padding: 0 0.8vw 0 0;
	}
	.portion{
		width: 25%;
		/*margin-left: -1vh;*/
		flex-grow: 1;
		/*margin-right: -1vh;*/
		min-width: 1vw;
		flex-direction: column;
		transition: width 1s ease-out;
	}
	.paybar{
		height: 1vw;
		width: 100%;
		/*background-color: white;
		border: 4px solid #222222;*/
		border-radius: 2vw 0 0 2vw;
		padding: 0.4vw;
	}
	#benefits .paybar{
		background-color: var(--purple);
	}
	#tax .paybar{
		background-color: var(--blue);
	}
	#retirement .paybar{
		background-color: var(--lightgreen);
	}
	#takehome .paybar{
		z-index: 0;
		border-radius: 2vw;
		background-color: var(--green);
	}
	.portion .text{
		margin: 1vw auto 0 auto;
		padding-left: 0.8vw;
	}
	#underpay .paybar{
		background-color: var(--green);
	}
	#overpay .paybar{
		background-color: var(--gold);
	}
	#underpay.underonly .paybar, #overpay .paybar{
		border-radius: 2vw;
	}
	#underpay.underonly{
		flex-grow: 0;
	}
	#overpay.underonly{
		display: none;
	}
	/*.bar:first-child{
		background-color: #207350;
		margin-bottom: 0.5vh
	}
	.bar{
		height: 1.5vw;
    		background-color: var(--gold);
    		display: block;
    		width: 0%;
		margin-bottom: 0.5vh;
		transition: width 1s ease-out;
		border-radius: 1.5vw;
	}
	.dividers{
		height: 1.5vw;
		position: relative;
		margin-top: -2.5vh;
		display: flex;
		flex-direction: row;
		justify-content: space-evenly;
		margin-bottom: 0.5vh;
	}
	.divider{
		height: 100%;
		width: 4px;
		background-color: #222222;
	}*/
	#total{
		text-align: right;
	}
	#clock{
		font-size: 2vw;
		color: var(--gold);
		text-align: center;
	}
	#day{
		text-align: left;
	}

	#text{
		column-gap: 2.5vw;
	}
	#timeentry{
		background-color: rgba(255, 255, 255, 0.03);
    	border: 0.25vw solid #ffffff00;
		padding: 1.5vw;
		resize: none;
		width: 100%;
		flex-basis: 50%;
		line-height: 1.5em;
		border-radius: 1vw;
	}
	#timeentry:focus {
		outline: none !important;
    	border: 0.25vw solid #373737;
	}
	#projects{
		flex-basis: 50%;
    	gap: 1vw;
    	flex-wrap: wrap;
    	align-content: flex-start;
	}
	#projects .project:first-child{
		display: none;
	}
	.project{
		border: solid 0.25vw #373737;
		border-radius: 1vw;
	}
	.project div{
		padding: 0.75vw;
	}
	.project div:first-child{
    	border-right: solid 0.25vw #373737;
	}
	#weekletters{
		gap: 2.2vw;
		margin: 1vw 1.1vw 1vw 0.9vw;
	}
	</style>
</head>
<body>
	<script type="text/javascript">
		var projectlist = [];
		var projecttime = [];
		var quartersworked = 0;
		var quartersover = 0;
		var dayofweek = 0;

		const t2 = calculatePay(128, 160).takehome;
		const t4 = calculatePay(160, 160).takehome;

		function updateBoard(day) {

			if (day != undefined){
				//CHANGING DAY OR SAME DAY
				dayofweek = day;
				document.getElementById('timeentry').value = localStorage.getItem('textContent'+dayofweek);
			}
			//ELSE SAVE AND REFRESH
			localStorage.setItem('textContent'+dayofweek, document.getElementById('timeentry').value);

			clearBoard();
			clearProjects();

			let daycircles = document.querySelectorAll("#week1 > div > svg > circle, #week2 > div > svg > circle");
			for (var i = 0; i < daycircles.length; i++) {
				if (daycircles[i].parentNode.parentNode.getAttribute("data-day") == dayofweek){
					turnOnCircle(daycircles[i]);
				}
				else{
					turnOffCircle(daycircles[i]);
				}
			}

			const lines = document.getElementById('timeentry').value.split(/\r?\n/);

			let over32 = 0;
			quartersworked = 0;
			quartersover = 0;

			for (var i = 0; i < lines.length; i++) {
				let pattern = /\d{1,4}/g; 
				let result = lines[i].match(pattern);
				if (result == null || result[0] == undefined || result[1] == undefined){
					break;
				}
				let starttime = result[0];
				let endtime = result[1];
				let note = lines[i].slice(lines[i].search(/ /i)+1);
				//console.log('start: '+starttime+', end: '+endtime+', note:'+note);

				let starthour;
				let startmin;
				let endhour;
				let endmin;

				if (starttime.length <= 2){
					starthour = parseInt(starttime);
					startmin = 0;}
				else{
					startmin = parseInt(starttime.slice(-2));
					starthour = parseInt(starttime.slice(0, -2));}

				if (endtime.length <= 2){
					endhour = parseInt(endtime);
					endmin = 0;}
				else{
					endmin = parseInt(endtime.slice(-2));
					endhour = parseInt(endtime.slice(0, -2));}

				//console.log(starthour+':'+startmin+' , '+endhour+':'+endmin);

				var noteindex = projectlist.indexOf(note.toUpperCase());
				var projecthours = ((endhour-starthour) + (endmin-startmin)/60);
				if (noteindex >= 0){
					projecttime[noteindex] += projecthours;
				}
				else{
					projectlist.push(note.toUpperCase());
					projecttime.push(projecthours);
				}

				let timecounter = projecthours*4;
				let columns = document.getElementById('day1').getElementsByClassName('column');

				for (var a = starthour; a <= endhour; a++) {
					let circles = columns[a].getElementsByTagName('circle');
					if (a == starthour){
						for (var b = startmin/15;b <= 3 && timecounter>0; b++) {
							over32++;
							if (over32 > 32){
								turnOnCircle(circles[b], true);
								quartersover++;
							}
							else{
								turnOnCircle(circles[b], false);
								quartersworked++;
							}
							timecounter--;
						}
					}
					else{
						for (var b = 0;b <= 3 && timecounter>0; b++) {
							over32++;
							if (over32 > 32){
								turnOnCircle(circles[b], true);
								quartersover++;
							}
							else{
								turnOnCircle(circles[b], false);
								quartersworked++;
							}
							timecounter--;
						}
					}
				}
			}

			localStorage.setItem('quarters'+dayofweek, (quartersworked+quartersover));

			let biweekquartersw1 = 0;
			let biweekquartersw2 = 0;
			for (var i = 0; i < 7; i++) {
				biweekquartersw1 += Number(localStorage.getItem('quarters'+i));
			}
			for (var i = 7; i < 14; i++) {
				biweekquartersw2 += Number(localStorage.getItem('quarters'+i));
			}
			
			let pay = calculatePay(biweekquartersw1, biweekquartersw2);

			let benefits = document.getElementById("benefits");
			benefits.style.width = pay.benefits+"%";
			benefits.getElementsByClassName("text")[0].innerHTML = pay.benefits;
			let tax = document.getElementById("tax");
			tax.style.width = pay.tax+"%";
			tax.getElementsByClassName("text")[0].innerHTML = pay.tax;
			let retirement = document.getElementById("retirement");
			retirement.style.width = pay.retirement+"%";
			retirement.getElementsByClassName("text")[0].innerHTML = pay.retirement;
			let takehome = document.getElementById("takehome");
			takehome.style.width = pay.takehome+"%";
			takehome.getElementsByClassName("text")[0].innerHTML = pay.takehome;


			let originalElement = document.getElementsByClassName('project')[0];

			for (var i = 0; i < projectlist.length; i++) {
				const clonedElement = originalElement.cloneNode(true);
				clonedElement.children[0].innerText = projectlist[i];
				clonedElement.children[1].innerText = projecttime[i].toFixed(2);
				document.getElementById('projects').appendChild(clonedElement);
			}
			document.getElementById('total').innerText = ((quartersworked/4)+(quartersover/4)) + ' hrs';


			let t1 = calculatePay(128+quartersworked, 160).takehome;
			//let t2 = calculatePay(128, 160).takehome;
			let t3 = calculatePay(160+quartersover, 160).takehome;
			//let t4 = calculatePay(160, 160).takehome;

			let dayunderpay = t1-t2;
			let dayoverpay = t3-t4;
			let dayunderdivider = t4-t2;

			let underpay = document.getElementById("underpay");
			let overpay = document.getElementById("overpay");

			if (dayoverpay > 0){
				underpay.classList.remove("underonly");
				overpay.classList.remove("underonly");

				underpay.style.width = (dayunderpay)+"%";
				underpay.getElementsByClassName("text")[0].innerHTML = dayunderpay;
				overpay.style.width = dayoverpay+"%";
				overpay.getElementsByClassName("text")[0].innerHTML = dayoverpay;
			}
			else{
				underpay.classList.add("underonly");
				overpay.classList.add("underonly");

				underpay.style.width = (100*dayunderpay/dayunderdivider)+"%";
				underpay.getElementsByClassName("text")[0].innerHTML = dayunderpay;
				overpay.style.width = 0+"%";
				overpay.getElementsByClassName("text")[0].innerHTML = 0;
			}

		}
		function clearBoard() {
			circles = document.getElementsByTagName('circle');
			for (var i = 0; i < circles.length; i++) {
				turnOffCircle(circles[i]);
			}
		}
		function turnOnCircle(circle, isOvertime){
			if (isOvertime){
				circle.setAttribute('fill', 'var(--gold)');
				circle.setAttribute('stroke', 'var(--gold)');
				circle.setAttribute('data-toggle', 'over');
			}
			else{
				circle.setAttribute('fill', 'white');
				circle.setAttribute('stroke', 'white');
				circle.setAttribute('data-toggle', 'on');
			}
		}
		function turnOffCircle(circle){
			if (circle.getAttribute('data-hour')=='nowork') {
				circle.setAttribute('fill', 'none');
				circle.setAttribute('stroke', 'var(--grey)');
			}
			else{
				circle.setAttribute('fill', 'none');
				circle.setAttribute('stroke', 'white');
			}
			circle.setAttribute('data-toggle', 'off');
		}
		function toggleCircle(circle, overide, isOvertime){
			if (circle.getAttribute('data-toggle')=='off'){
				turnOnCircle(circle, isOvertime);
			}
			else if (overide != false){
				turnOffCircle(circle);
			}
		}
		function clearProjects(){
			projectlist = [];
			projecttime = [];
			let originalElement = document.getElementsByClassName('project')[0];
			const clonedElement = originalElement.cloneNode(true);
			document.getElementById('projects').innerHTML = '';
			document.getElementById('projects').appendChild(clonedElement);
		}
		const weekdays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
		const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
		function updateClock() {
			const now = new Date();
			const month = now.getMonth();
			const weekday = now.getDay();
			const day = now.getDate();
			const hours = now.getHours();
			const minutes = now.getMinutes();
			const seconds = now.getSeconds();

			function padZero(number) {
				return number < 10 ? '0' + number : number;
			}
			const formattedTime = `${padZero(hours)}:${padZero(minutes)}`;

			document.getElementById('clock').textContent = formattedTime;
			document.getElementById('day').textContent = (weekdays[weekday]+"  "+months[month]+"  "+day).toUpperCase();
		}
		function getPayWeekDay(){
		    const specificDate = new Date("2025-08-11T00:00:01-04:00");
		    const currentDate = new Date();

		    const specificDateMillis = specificDate.getTime();
		    const currentMillis = currentDate.getTime();

		    const differenceMillis = currentMillis - specificDateMillis;

		    const millisecondsInDay = 1000 * 60 * 60 * 24;
		    const daysSinceDate = differenceMillis / millisecondsInDay;

		    return Math.floor(daysSinceDate%14);
		}
		function calculatePay(w1, w2){
			let regulartime = 0;
			let overtime = 0;
			regulartime += Math.min(Math.max(w1, 0), 160);
			regulartime += Math.min(Math.max(w2, 0), 160);
			overtime += Math.max(0, w1-160);
			overtime += Math.max(0, w2-160);

			let grosspay = ((regulartime/4)*24)+((overtime/4)*32)+6.51;
			let benefits = 66.19;
			let benefitsdeduct = Math.round(Math.min(Math.max(grosspay, 0), 66.19));

			let taxablegross = grosspay-benefits;

			let statetax = Math.min(Math.max(((taxablegross-461.54)), 0), 461.54)*0.0519;
			let medicaretax = taxablegross*0.0145;
			let socialtax = taxablegross*0.062;
			let federaltax = //(taxablegross <= 2441) ? ((45.90)+(0.12*(taxablegross-1036))) : ((214.50)+(0.22*(taxablegross-2441)));
			(Math.min(Math.max(taxablegross-577, 0), 1036)*0.1)+(Math.min(Math.max(taxablegross-1036, 0), 2441)*0.12)+(Math.min(Math.max(taxablegross-2441, 0), 4552)*0.22);

			let taxdeduct = Math.max(0, Math.round(statetax+medicaretax+socialtax+federaltax));

			let retirementdeduct = Math.round(grosspay*0.09);

			let otherincome = Math.round(23.50);

			let pay = Math.max(0, Math.round(grosspay+otherincome-benefitsdeduct-taxdeduct-retirementdeduct));

			return {benefits : benefitsdeduct, tax : taxdeduct, retirement : retirementdeduct, takehome : pay};
		}
	</script>
	<div id="day1">
		<div class="column">
			<div class="hour">0</div>
			<div class="button">
				<svg height="4vw" width="4vw">
				  <circle r="1.35vw" cx="2vw" cy="2vw" fill="none" stroke="var(--grey)" stroke-width="0.5vw" data-toggle="off" data-hour="nowork"/>
				</svg>
			</div>
			<script type="text/javascript" id="inlineScript">{
				let originalElement = document.getElementsByClassName("button")[0];
				
				for (let i = 0; i < 3; i++) {
					const originalElement = document.getElementsByClassName("button")[0];
					const clonedElement = originalElement.cloneNode(true);
					document.getElementsByClassName("column")[0].appendChild(clonedElement);
				}

				var scriptElement = document.getElementById("inlineScript"); 
				scriptElement.parentNode.removeChild(scriptElement); 

			}</script>
		</div>
	</div>
	<div id="paycheck">
		<div class="portion" id="benefits">
			<div class="paybar"></div>
			<div class="text">66</div>
		</div>
		<div class="portion" id="tax">
			<div class="paybar"></div>
			<div class="text">66</div>
		</div>
		<div class="portion" id="retirement">
			<div class="paybar"></div>
			<div class="text">66</div>
		</div>
		<div class="portion" id="takehome">
			<div class="paybar"></div>
			<div class="text">66</div>
		</div>
	</div>
	<div id="income">
		<div class="text" id="day">MONDAY</div>
		<div class="text" id="clock">12:10</div>
		<div class="text" id="total">0 hrs</div>
	</div>
	<div id="dailyincome">
		<div class="portion underonly" id="underpay">
			<div class="paybar"></div>
			<div class="text">120</div>
		</div>
		<div class="portion underonly" id="overpay">
			<div class="paybar"></div>
			<div class="text">50</div>
		</div>
		<!--
		<div class="bar" id="normalbar"></div>
		<div class="dividers">
			<div class="divider"></div>
			<div class="divider"></div>
		</div>
		<div class="bar" id="overbar"></div>
		<div class="dividers">
			<div class="divider"></div>
			<div class="divider"></div>
		</div>-->
	</div>
	<div id="text">
		<div id="weeks">
			<div class="column" id="weekletters">
				<div class="hour">M</div>
				<div class="hour">T</div>
				<div class="hour">W</div>
				<div class="hour">T</div>
				<div class="hour">F</div>
				<div class="hour">S</div>
				<div class="hour">S</div>
			</div>
			<div class="column" id="week1">
				<div class="button" onclick="
					const circle = this.getElementsByTagName('circle')[0];
					toggleCircle(circle, true, false);
					updateBoard(this.getAttribute('data-day'));
					//changeDay(this.getAttribute('data-day'));
					
				" data-day="0">
					<svg height="4vw" width="4vw">
					  <circle r="1.35vw" cx="2vw" cy="2vw" fill="none" stroke="white" stroke-width="0.5vw" data-toggle="off" data-hour="work"/>
					</svg>
				</div>
				<script type="text/javascript" id="inlineScript">{
				
					let originalElement = document.getElementById("week1").getElementsByClassName("button")[0];
					for (let i = 0; i < 6; i++) {
						const clonedElement = originalElement.cloneNode(true);
						clonedElement.setAttribute('data-day', (i+1));

						if (i > 3) {
							let circle = clonedElement.getElementsByTagName('circle')[0];
							circle.setAttribute('data-hour', 'nowork');
							circle.setAttribute('stroke', 'var(--grey)');
						}
						document.getElementById("week1").appendChild(clonedElement);
					}

					var scriptElement = document.getElementById("inlineScript"); 
					scriptElement.parentNode.removeChild(scriptElement); 

				}</script>
			</div>
			<div class="column" id="week2">
				<div class="button" onclick="
					const circle = this.getElementsByTagName('circle')[0];
					toggleCircle(circle, true, false);
					updateBoard(this.getAttribute('data-day'));
					//changeDay(this.getAttribute('data-day'));
					
				" data-day="7">
					<svg height="4vw" width="4vw">
					  <circle r="1.35vw" cx="2vw" cy="2vw" fill="none" stroke="white" stroke-width="0.5vw" data-toggle="off" data-hour="work"/>
					</svg>
				</div>
				<script type="text/javascript" id="inlineScript">{
				
					let originalElement = document.getElementById("week2").getElementsByClassName("button")[0];
					for (let i = 7; i < 13; i++) {
						const clonedElement = originalElement.cloneNode(true);
						clonedElement.setAttribute('data-day', (i+1));

						if (i > 10) {
							let circle = clonedElement.getElementsByTagName('circle')[0];
							circle.setAttribute('data-hour', 'nowork');
							circle.setAttribute('stroke', 'var(--grey)');
						}
						document.getElementById("week2").appendChild(clonedElement);
					}

					var scriptElement = document.getElementById("inlineScript"); 
					scriptElement.parentNode.removeChild(scriptElement); 

				}</script>
			</div>
		</div>
		<textarea name="paragraph_text" cols="10" rows="10" class="text" id="timeentry" onblur="

			updateBoard();

		" ></textarea>
		<div id="projects">
			<div class="project text">
				<div>HN235123</div>
				<div>1.25</div>
		</div>
	</div>

	<script type="text/javascript">
		let originalElement = document.getElementsByClassName("column")[0];

		for (let i = 1; i < 24; i++) {
			const clonedElement = originalElement.cloneNode(true);
			clonedElement.getElementsByClassName('hour')[0].innerText = i;
			var circles = clonedElement.getElementsByTagName('circle');
			if (i > 7 && i < 17 && i != 12) {
				clonedElement.classList.add("workcolumn");
				for (var a = 0; a < circles.length; a++) {
					circles[a].setAttribute('data-hour', 'work');
					circles[a].setAttribute('stroke', 'white');
				}
			}
			document.getElementById("day1").appendChild(clonedElement);
		}
		updateClock();
		setInterval(updateClock, 1000);

		updateBoard(getPayWeekDay());
	</script>
</body>

</html>
