<!DOCTYPE html>
<html>
<head>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap');
	</style>
	<style>
		:root {
		  --grey: #595959;
		  --white: #ffffff;
		  --gold: #F9BB36;
		}
	body {
	  background-color: #222222;
	  margin: 0;
	}
	div{
		display: flex;
	}

	::-webkit-scrollbar {
	  width: 1vw;
	}
	::-webkit-scrollbar-track {
	  background: none; 
	}
	::-webkit-scrollbar-thumb {
	  background: var(--grey); 
	  border-radius: 1vw;
	}
	::-webkit-scrollbar-thumb:hover {
	  background: #555; 
	}

	.column{
		display: flex;
  		flex-direction: column;
	}
	#day1{
		display: flex;
		flex-direction: row;
		justify-content: center;
		margin:3%;
	}
	.button{
		display: flex;
	}
	.hour{
		font-family: roboto;
    	color: white;
    	font-size: 1.5vw;
    	align-self: center;
	}
	.text{
		font-family: roboto;
    	color: white;
    	font-size: 1.5vw;

	}
	.workcolumn{
		background-color: #ffffff17;
	}
	#income{
		margin: 0vw 2.5vw;
		justify-content: space-between;
	}
	#total{
		font-size: 2vw;
	}
	#text{
		margin: 2.5vw;
		column-gap: 2.5vw;
	}
	#timeentry{
		background-color: rgba(255, 255, 255, 0.03);
    	border: 0.25vw solid #ffffff00;
		padding: 1vw;
		resize: none;
		width: 100%;
		flex-basis: 50%;
	}
	#timeentry:focus {
		outline: none !important;
    	border: 0.25vw solid #373737;
	}
	#projects{
		flex-basis: 50%;
    	gap: 1vw;
    	flex-wrap: wrap;
    	align-content: flex-start;
	}
	#projects .project:first-child{
		display: none;
	}
	.project{
		border: solid 0.25vw #373737;
	}
	.project div{
		padding: 0.75vw;
	}
	.project div:first-child{
    	border-right: solid 0.25vw #373737;
	}
	</style>
</head>
<body><script type="text/javascript">
		var projectlist = [];
		var projecttime = [];
		var over32 = false;
		function updateBoard() {
			over32 = false;
			circles = document.getElementsByTagName('circle');
			var quartersworked = 0;
			var quartersover = 0;
			for (var i = 0; i < circles.length; i++) {
				var datatoggle = circles[i].getAttribute('data-toggle');
				if (datatoggle!='off'){
					if (datatoggle=="on"){
						quartersworked++;
						if (quartersworked >= 32){
							over32 = true;
						}
					}
					else if(datatoggle=="over"){
						quartersover++;
					}
				}
			}
			document.getElementById('total').innerText = '$ ' + ((quartersworked*15/4)+(quartersover*23/4));
		}
		function clearBoard() {
			circles = document.getElementsByTagName('circle');
			for (var i = 0; i < circles.length; i++) {
				turnOffCircle(circles[i]);
			}
			console.log('cleared');
		}
		function turnOnCircle(circle, isOvertime){
			if (isOvertime || over32){
				circle.setAttribute('fill', 'var(--gold)');
				circle.setAttribute('stroke', 'var(--gold)');
				circle.setAttribute('data-toggle', 'over');
			}
			else{
				circle.setAttribute('fill', 'white');
				circle.setAttribute('stroke', 'white');
				circle.setAttribute('data-toggle', 'on');
			}
			updateBoard();
		}
		function turnOffCircle(circle){
			if (circle.getAttribute('data-hour')=='nowork') {
				circle.setAttribute('fill', 'none');
				circle.setAttribute('stroke', 'var(--grey)');
			}
			else{
				circle.setAttribute('fill', 'none');
				circle.setAttribute('stroke', 'white');
			}
			circle.setAttribute('data-toggle', 'off');
			updateBoard();
		}
		function toggleCircle(circle, overide, isOvertime){
			if (circle.getAttribute('data-toggle')=='off'){
				turnOnCircle(circle, isOvertime);
			}
			else if (overide != false){
				turnOffCircle(circle);
			}
		}
		function clearProjects(){
			projectlist = [];
			projecttime = [];
			const originalElement = document.getElementsByClassName('project')[0];
			const clonedElement = originalElement.cloneNode(true);
			document.getElementById('projects').innerHTML = '';
			document.getElementById('projects').appendChild(clonedElement);
		}
	</script>
	<div id="day1">
		<div class="column">
			<div class="hour">0</div>
			<div class="button" onclick="
				const circle = this.getElementsByTagName('circle')[0];
				toggleCircle(circle, true, false);
				
			" oncontextmenu="
				const circle = this.getElementsByTagName('circle')[0];
				toggleCircle(circle, true, true);
				updateBoard();
				return false;
			">
				<svg height="4vw" width="4vw">
				  <circle r="1.35vw" cx="2vw" cy="2vw" fill="none" stroke="var(--grey)" stroke-width="0.5vw" data-toggle="off" data-hour="nowork"/>
				</svg>
			</div>
			<script type="text/javascript" id="inlineScript">
			
			for (let i = 0; i < 3; i++) {
				const originalElement = document.getElementsByClassName("button")[0];
				const clonedElement = originalElement.cloneNode(true);
				document.getElementsByClassName("column")[0].appendChild(clonedElement);
			}

			var scriptElement = document.getElementById("inlineScript"); 
			scriptElement.parentNode.removeChild(scriptElement); 

			</script>
		</div>
	</div>
	<div id="income">
		<div class="text">Estimated Income</div>
		<div class="text" id="total">$0</div>
	</div>
	<div id="text">
		<textarea name="paragraph_text" cols="10" rows="10" class="text" id="timeentry" onblur="
			const text = this.value;
			const lines = text.split(/\r?\n/);

			clearBoard();
			clearProjects();

			for (var i = 0; i < lines.length; i++) {
				let pattern = /\d{1,4}/g; 
				let result = lines[i].match(pattern);
				let starttime = result[0];
				let endtime = result[1];
				let note = lines[i].slice(lines[i].search(/ /i)+1);
				console.log('start: '+starttime+', end: '+endtime+', note:'+note);

				let starthour;
				let startmin;
				let endhour;
				let endmin;

				if (starttime.length <= 2){
					starthour = parseInt(starttime);
					startmin = 0;}
				else{
					startmin = parseInt(starttime.slice(-2));
					starthour = parseInt(starttime.slice(0, -2));}

				if (endtime.length <= 2){
					endhour = parseInt(endtime);
					endmin = 0;}
				else{
					endmin = parseInt(endtime.slice(-2));
					endhour = parseInt(endtime.slice(0, -2));}

				console.log(starthour+':'+startmin+' , '+endhour+':'+endmin);

				var noteindex = projectlist.indexOf(note.toUpperCase());
				var projecthours = ((endhour-starthour) + (endmin-startmin)/60);
				if (noteindex >= 0){
					projecttime[noteindex] += projecthours;
				}
				else{
					projectlist.push(note.toUpperCase());
					projecttime.push(projecthours);
				}

				let timecounter = projecthours*4;
				let columns = document.getElementsByClassName('column');

				for (var a = starthour; a <= endhour; a++) {
					let circles = columns[a].getElementsByTagName('circle');
					if (a == starthour){
						for (var b = startmin/15;b <= 3 && timecounter>0; b++) {
							turnOnCircle(circles[b]);
							timecounter--;
						}
					}
					else{
						for (var b = 0;b <= 3 && timecounter>0; b++) {
							turnOnCircle(circles[b]);
							timecounter--;
						}
					}
				}

				// for (var a = starthour; a <= endhour; a++) {
				// 	let circles = document.getElementsByClassName('column')[a].getElementsByTagName('circle');

				// 	if ((endmin-startmin) <= 0){
				// 			for (var b = 0; b < endmin; b+=15) {
				// 				turnOnCircle(circles[b/15]);
				// 			}
				// 		}


				// 	if (endhour-a == 0){
				// 		if ((endmin-startmin) <= 0){
				// 			for (var b = 0; b < endmin; b+=15) {
				// 				turnOnCircle(circles[b/15]);
				// 			}
				// 		}
				// 		else{
				// 			for (var b = startmin; b < endmin; b+=15) {
				// 				turnOnCircle(circles[b/15]);
				// 			}
				// 		}
				// 	}
				// 	else if (endhour-a == 1){
				// 		for (var b = startmin; b <= 45; b+=15) {
				// 			turnOnCircle(circles[b/15]);
				// 		}
				// 	}
				// 	else if (endhour-a > 1){
				// 		turnOnCircle(circles[0]);
				// 		turnOnCircle(circles[1]);
				// 		turnOnCircle(circles[2]);
				// 		turnOnCircle(circles[3]);
				// 	}
				// }
			}

			for (var i = 0; i < projectlist.length; i++) {
				const originalElement = document.getElementsByClassName('project')[0];
				const clonedElement = originalElement.cloneNode(true);
				clonedElement.children[0].innerText = projectlist[i];
				clonedElement.children[1].innerText = projecttime[i].toFixed(2);
				document.getElementById('projects').appendChild(clonedElement);
			}

			console.log(projectlist);
			console.log(projecttime);

		"></textarea>
		<div id="projects">
			<div class="project text">
				<div>HN235123</div>
				<div>1.25</div>
		</div>
	</div>

	<script type="text/javascript">
	for (let i = 1; i < 24; i++) {
		const originalElement = document.getElementsByClassName("column")[0];
		const clonedElement = originalElement.cloneNode(true);
		clonedElement.getElementsByClassName('hour')[0].innerText = i;
		var circles = clonedElement.getElementsByTagName('circle');
		if (i > 7 && i < 17 && i != 12) {
			clonedElement.classList.add("workcolumn");
			for (var a = 0; a < circles.length; a++) {
				circles[a].setAttribute('data-hour', 'work');
				circles[a].setAttribute('stroke', 'white');
			}
		}
		document.getElementById("day1").appendChild(clonedElement);
	}
	console.log('elements setup');
	</script>
</body>

</html>